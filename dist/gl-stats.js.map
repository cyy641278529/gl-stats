{"version":3,"file":"gl-stats.js","sources":["../lib/gl-bind.js","../index.js"],"sourcesContent":["let glifuncs = {\n  // default(original, name, ...args) {\n  //   // this.__gli.callStack.push(name, args);\n  //   // this.__gli.histogram.add(name);\n  //   let ret = original.apply(this, args);\n  //   // this.__gli.callStack.update(name);\n  //   return ret;\n  // },\n\n  drawArrays (original, name, ...args) {\n    if (this.__gli) {\n      ++this.__gli.totalDrawArraysCalls;\n    }\n    return original.apply(this, args);\n  },\n\n  drawElements (original, name, ...args) {\n    if (this.__gli) {\n      ++this.__gli.totalDrawElementsCalls;\n    }\n    return original.apply(this, args);\n  },\n};\n\nfunction _gliBind(name, origFn, newFn) {\n  return function () {\n    return newFn.apply(this, [origFn, name, ...arguments]);\n  };\n}\n\nexport default function bindWebGL() {\n  // DISABLE\n  // for (let name in WebGLRenderingContext.prototype) {\n  //   try {\n  //     if (typeof WebGLRenderingContext.prototype[name] !== 'function') {\n  //       continue;\n  //     }\n\n  //     let newFunc = glifuncs[name] || glifuncs.default;\n  //     WebGLRenderingContext.prototype[name] = _gliBind(name, WebGLRenderingContext.prototype[name], newFunc);\n  //   } catch (err) {\n  //     console.error(err);\n  //   }\n  // }\n\n  for (let name in glifuncs) {\n    let newFunc = glifuncs[name];\n    WebGLRenderingContext.prototype[name] = _gliBind(name, WebGLRenderingContext.prototype[name], newFunc);\n  }\n\n  WebGLRenderingContext.prototype.__reset = function () {\n    this.__gli.commands = [];\n    this.__gli.totalDrawArraysCalls = 0;\n    this.__gli.totalDrawElementsCalls = 0;\n  };\n\n  WebGLRenderingContext.prototype.__inspect = function () {\n    if (this.__gli) {\n      return;\n    }\n\n    let modules = {\n      commands: [],\n      totalDrawArraysCalls: 0,\n      totalDrawElementsCalls: 0,\n    };\n\n    // modules.bufferViewer = new glpBufferViewer(this);\n    // modules.callStack = new glpCallStack(this);\n    // modules.frameControl = new glpFrameControl(this, window);\n    // modules.duplicateProgramDetection = new glpDuplicateProgramDetection(this);\n    // modules.histogram = new glpHistogram(this);\n    // modules.messages = new glpMessages(this);\n    // modules.pixelInspector = new glpPixelInspector(this);\n    // modules.depthInspector = new glpDepthInspector(this);\n    // modules.programUsageCounter = new glpProgramUsageCounter(this);\n    // modules.stateTracker = new glpStateTracker(this);\n    // modules.textureViewer = new glpTextureViewer(this);\n    // modules.shaderViewer = new glpShaderViewer(this);\n    // modules.mipmapViewer = new glpMipmapViewer(this);\n\n    this.__gli = modules;\n    return modules;\n  };\n}","import bindWebGL from './lib/gl-bind';\n\nlet _css = `\n  .glstats {\n    position: absolute;\n    z-index: 9999;\n\n    padding: 5px;\n    width: 150px;\n    left: 5px;\n    top: 5px;\n\n    font-size: 10px;\n    font-family: 'Roboto Condensed', tahoma, sans-serif;\n    overflow: hidden;\n    user-select: none;\n    cursor: default;\n\n    background: rgba(0, 0, 0, 0.6);\n    border-radius: 3px;\n\n  }\n\n  .glstats-container {\n    display: flex;\n    flex-direction: column;\n    color: #888;\n    white-space: nowrap;\n  }\n\n  .glstats-item {\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    text-align: left;\n  }\n\n  .flex-1 {\n    flex: 1;\n  }\n\n  .right {\n    text-align: right;\n  }\n`;\n\n// add global style\nlet styleEL = document.createElement('style');\nstyleEL.type = 'text/css';\nstyleEL.textContent = _css;\ndocument.head.appendChild(styleEL);\n\nbindWebGL();\n\nfunction _addItem(dom, name) {\n  let itemEL = document.createElement('div');\n  itemEL.className = 'glstats-item';\n\n  let spanName = document.createElement('span');\n  spanName.className = 'flex-1';\n  spanName.textContent = name;\n\n  let spanValue = document.createElement('span');\n  spanValue.className = 'flex-1 right';\n\n  let spanValueText = document.createTextNode('');\n  spanValueText.nodeValue = 'n/a';\n\n  itemEL.appendChild(spanName);\n  itemEL.appendChild(spanValue);\n  spanValue.appendChild(spanValueText);\n\n  dom.appendChild(itemEL);\n\n  return spanValueText;\n}\n\nexport default class GLStats {\n  constructor(dom, opts = {}) {\n    this._root = document.createElement('div');\n    this._root.className = 'glstats';\n\n    let containerEL = document.createElement('div');\n    containerEL.className = 'glstats-container';\n\n    this._root.appendChild(containerEL);\n      this._drawcalls = _addItem(containerEL, 'Draw Calls');\n\n    dom.appendChild(this._root);\n  }\n\n  inspect (gl) {\n    gl.__inspect();\n    this._gl = gl;\n  }\n\n  reset () {\n    let gli = this._gl.__gli;\n    this._drawcalls.nodeValue = gli.totalDrawArraysCalls + gli.totalDrawElementsCalls;\n\n    this._gl.__reset();\n  }\n}"],"names":[],"mappings":"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"}